<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å»ƒå¢Ÿã‹ã‚‰ã®è„±å‡ºã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c1810, #1a0f08);
            color: #f4f1e8;
            width: 100%;
            overflow-x: hidden;  /* â†ã“ã‚Œé‡è¦ */
        }

        .game-container {
            width: 100%;
            max-width: 1408px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .room-view {
            aspect-ratio: 1/1;           /* â†æ­£æ–¹å½¢ */
            width: 90vw;                 /* ç”»é¢å¹…ã®90% */
            max-width: 640px;            /* PCæ™‚æœ€å¤§ã‚µã‚¤ã‚º */
            max-height: 90vw;       
            background-size: cover;      
            background-repeat: no-repeat;
            background-position: center center;
            position: relative;
            margin: 0 auto;
            cursor: crosshair;
            transition: background-image 0.5s ease-in-out;
        }

        #roomImage {
            width: 100%;
            height: 100%;
            object-fit: contain;    /* ç”»åƒå…¨ä½“ã‚’è¡¨ç¤º */
            position: absolute;
            left: 0;
            top: 0;
            z-index: 0;
            pointer-events: none;   /* ç”»åƒä¸Šã§ã‚‚ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒé€šã‚‹ã‚ˆã†ã« */
        }

        .clickable-area {
            position: absolute;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            z-index: 2;
            pointer-events: auto;

        }

        .clickable-area:hover {
            border-color: #d4af37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .ui-panel {
            flex-wrap: wrap;
            width: 100%;
            max-width: 1048px;
            min-height: 120px;
            background: #2c1810;
            box-sizing: border-box;
            display: flex;
        }

        .inventory {
            flex: 1;
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
            padding: 0 20px;
            width:100%;
        }

        .inventory-slot {
            width: 14vw; 
            height: 14vw; 
            max-width: 80px; 
            max-height: 80px;
            border: 2px solid #d4af37;
            background: rgba(212, 175, 55, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .inventory-slot:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: scale(1.05);
        }

        .inventory-slot.selected {
            border: 3px solid #9f2b02;   /* é‡‘è‰²ãƒ»å¤ªã‚æ¨å¥¨ */
            box-shadow: 0 0 12px #ff8c0099;
            background: rgba(255, 215, 0, 0.15);
        }

        .inventory-slot img {
            max-width: 60px;
            max-height: 60px;
            object-fit: contain;
        }

        .info-panel {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .message-area {
            background: rgba(0, 0, 0, 0.8);
            padding: 5px;
            border-radius: 5px;
            margin-bottom: 10px;
            height:80px;
            min-height: 40px;
            border: 1px solid #d4af37;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .nav-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #d4af37, #b8941f);
            border: none;
            border-radius: 5px;
            color: #1a0f08;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: linear-gradient(135deg, #b8941f, #d4af37);
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: linear-gradient(135deg, #2c1810, #1a0f08);
            padding: 30px;
            border-radius: 10px;
            border: 3px solid #d4af37;
            max-width: calc(100vw - 60px);
            text-align: center;
        }

        .modal button {
            margin: 10px;
            padding: 10px 20px;
            background: #d4af37;
            border: none;
            border-radius: 5px;
            color: #1a0f08;
            cursor: pointer;
            font-weight: bold;
        }

        .puzzle-input {
            width: 200px;
            padding: 10px;
            margin: 10px;
            border: 2px solid #d4af37;
            background: rgba(244, 241, 232, 0.9);
            color: #1a0f08;
            border-radius: 5px;
            text-align: center;
            font-size: 16px;
        }

        .title {
            position: absolute;
            top: 0px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 2px 8px;
            border: 2px solid #d4af37;
            border-radius: 25px;
            font-size: 12px;
            font-weight: bold;
            z-index: 100;
        }

        /* ç”»åƒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .image-placeholder {
            background: linear-gradient(135deg, #444, #666);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ccc;
            font-size: 14px;
            text-align: center;
            border-radius: 5px;
        }

        .notice {
            text-overflow: clip;
        }
        .save-area {
            display: flex;
            justify-content: center;
            gap: 18px;
            margin: 18px 0 4px 0;
            width: 40%;
        }

        @media (max-width: 600px) {
            .save-area {
                width: 100%;
                max-width: 100%;
                margin-left: 0;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                margin-top: 8px;
                gap: 16px;
            }
            .inventory {
                gap: 16px;
                align-items: center;
                padding: 0 2px;
                width:100%;
            }
        }

        .save-area .nav-btn {
            min-width: 80px;
            padding: 10px 18px;
            font-size: 15px;
            background: linear-gradient(135deg, #d4af37 85%, #b8941f 100%);
            border-radius: 8px;
            border: none;
            color: #1a0f08;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.1);
            transition: background 0.3s, transform 0.2s;
        }

        .save-area .nav-btn:hover {
            background: linear-gradient(135deg, #b8941f 70%, #d4af37 100%);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 0 12px #d4af3740;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="title">è¬ã®æ´‹é¤¨ã‹ã‚‰è„±å‡ºã›ã‚ˆ</div>
        
        <div class="room-view" id="roomView">
            <!-- ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã‚¨ãƒªã‚¢ã¯å‹•çš„ã«ç”Ÿæˆ -->
              <img id="roomImage" src="">
        </div>

        <div class="ui-panel">
            <div class="info-panel">
                <div class="message-area" id="messageArea">
                    æ°—ãŒä»˜ãã¨ã‚ãªãŸã¯å¤ã„æ´‹é¤¨ã«ç«‹ã£ã¦ã„ã¾ã—ãŸã€‚ç„é–¢ãƒ‰ã‚¢ã¯ã‚«ã‚®ãŒã‹ã‹ã£ã¦ã„ã¦å‡ºã‚‰ã‚Œã¾ã›ã‚“
                </div>
                <!-- <div class="navigation">
                    <button class="nav-btn" onclick="changeRoom('genkan')">ç„é–¢</button>
                    <button class="nav-btn" onclick="changeRoom('living')">å±…é–“</button>
                    <button class="nav-btn" onclick="changeRoom('bedroom')">å¯å®¤</button>
                    <button class="nav-btn" onclick="changeRoom('study')">æ›¸æ–</button>
                </div> -->
            </div>
            <div class="inventory" id="inventory">
                <div class="inventory-slot" onclick="useItem(0)"></div>
                <div class="inventory-slot" onclick="useItem(1)"></div>
                <div class="inventory-slot" onclick="useItem(2)"></div>
                <div class="inventory-slot" onclick="useItem(3)"></div>
                <div class="inventory-slot" onclick="useItem(4)"></div>
            </div>
            <button id="bgm-toggle" onclick="toggleBGM()" style="position:absolute;top:20px;right:20px;z-index:1000;">
            ğŸ”Š BGM
            </button> 
            <div class="save-area">
                <button class="nav-btn" onclick="saveGame()">ã‚»ãƒ¼ãƒ–</button>
                <button class="nav-btn" onclick="loadGame()">ãƒ­ãƒ¼ãƒ‰</button>
            </div>
        </div>
        <div class="notice">å½“ã‚µã‚¤ãƒˆã¯OtoLogicã®ç´ æã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ ä½œè€…:<a href="index.html">ã‚¹ãƒ©ã‚»ãƒ–ãƒ³</a></div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent">
            <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å†…å®¹ã¯å‹•çš„ã«ç”Ÿæˆ -->
        </div>
    </div>
    <audio id="bgm" src="sounds/sinpi no kyuuden.mp3" loop></audio>
    <audio id="se-click" src="sounds/Short_Accent18-1(Dry).mp3"></audio>
    <audio id="se-item" src="sounds/Inspiration02-1(High).mp3"></audio>
    <audio id="se-error" src="sounds/Quiz-Buzzer05-1(Mid).mp3"></audio>
    <audio id="se-tv" src="sounds/TV-Hardware02-01(Button).mp3"></audio>
    <audio id="se-skeleton" src="sounds/Motion-Tremble02-1(Short).mp3"></audio>
    <audio id="se-metal" src="sounds/Horror_Accent13-1(Short).mp3"></audio>
    <audio id="se-subclear" src="sounds/Quiz-Ding_Dong01-1(Short).mp3"></audio>
    <audio id="se-clear" src="sounds/Angel01-1.mp3"></audio>
    <audio id="se-parin" src="sounds/Onoma-Impact04-1(High).mp3"></audio>
    <script>
        // ã‚²ãƒ¼ãƒ è¨­å®š - ç”»åƒãƒ‘ã‚¹ã‚’ã“ã“ã§ç®¡ç†
        let IMAGES = {
            rooms: {
                genkan: 'images/genkan.jpg',        
                corridor: 'images/corridor.jpg',       
                dining: 'images/dining.jpg',      
                living: 'images/living.jpg',
                end: 'images/end.jpg',
                trueEnd: 'images/trueEnd.jpg'      
            },
            items: {
                key: 'images/key.jpg',              // éµã®ç”»åƒ
                drawerKey: 'images/drawerKey.jpg',
                coin: 'images/coin.jpg',
                pin: 'images/pin.jpg',
                oil: 'images/oil.jpg',
                jam: 'images/jam.jpg',
                scroll: 'images/scroll.jpg',        // å·»ç‰©ã®ç”»åƒ
                mirror: 'images/mirror.jpg',        // é¡ã®ç”»åƒ
                box: 'images/box.jpg',              // ç®±ã®ç”»åƒ
                treasure: 'images/treasure.jpg',    // å®¶å®ã®ç”»åƒ
                futonbo: 'images/futonbo.jpg',      // å¸ƒå›£ãŸãŸãã®ç”»åƒ
                smallKey: 'images/smallKey.jpg',    // å°ã•ã„éµã®ç”»åƒ
                book: 'images/book.jpg',            // çµµæœ¬ã®ç”»åƒ
            }
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            currentRoom: 'genkan',
            inventory: [],
            genkan: {
                flags: {
                    talkTo: {
                        skeleton:0
                    },
                    watchedPaper: false,
                    foundPin: false,
                }
            },
            corridor: {
                flags: {
                    foundDrawerKey: false,
                    talkTo: {
                        skeleton:0,
                        pic_left:0,
                        pic_center:0,
                        pic_right:0
                    },
                    talkToLeft:false,
                    talkToCenter:false,
                    talkToRight: false,
                }
            },
            dining: {
                flags: {
                    foundOil: false,
                    foundJam: false,
                    useOilToSkeleton: false,
                }
            },
            living: {
                flags: {
                    readMemo: false,
                }
            },
            flags: {
                skeletonFavor :0,
                foundKey: false,
                foundMirror: false,
                readScroll: false,
                solvedPuzzle: false,
                foundTreasure: false,
                foundSmallKey: false,
                foundFutonbo: false,
                foundBear: false,
                happyBear: false,
                foundBook:false,
                
            },
            selectedItem: null
        };

        // éƒ¨å±‹ãƒ‡ãƒ¼ã‚¿
        let rooms = {
            genkan: {
                name: 'ç„é–¢',
                description: 'è±ªè¯ãªæ´‹é¤¨ã®ç„é–¢ãƒ›ãƒ¼ãƒ«ã ',
                clickableAreas: [
                    {
                        x: 68, y: 37, width: 6, height: 9,
                        action: 'examine_genkan_paper',
                        description: 'ãƒ‰ã‚¢ã«ã¯å¼µã‚Šç´™',
                        zIndex:5
                    },
                    {
                        x: 77, y: 54, width: 3, height: 6,
                        action: 'examine_genkan_key',
                        description: 'éµãŒã‹ã‹ã£ã¦ã„ã‚‹',
                        zIndex:5
                    },
                    {
                        x: 58, y: 28, width: 23, height: 45,
                        action: 'examine_genkan_door',
                        description: 'ç„é–¢ãƒ‰ã‚¢'
                    },
                    {
                        x: 31, y: 54, width: 16, height: 19,
                        action: 'examine_genkan_chair',
                        description: 'è±ªè¯ãªæ¤…å­'
                    },
                    {
                        x: 12, y: 26, width: 12, height: 48,
                        action: 'examine_genkan_left_door',
                        description: 'ç«‹æ´¾ãªæœ¨è£½ã®ãƒ‰ã‚¢'
                    },
                    {
                        x: 39, y: 33, width: 10, height: 13,
                        action: 'examine_genkan_picture',
                        description: 'å¥³æ€§ã®è‚–åƒç”»'
                    },
                    {
                        x: 90, y: 43, width: 8, height: 8,
                        action: 'examine_genkan_spidernet',
                        description: 'ã‚¯ãƒ¢ã®å·£'
                    },
                    {
                        x: 90, y: 88, width: 9, height: 4,
                        action: 'examine_genkan_memo',
                        description: 'ãƒ¡ãƒ¢'
                    },
                    {
                        x: 96.7, y: 74, width: 2.7, height: 2.6,
                        action: 'examine_genkan_pin',
                        description: '?'
                    },
                    {
                        x: 83, y: 54, width: 12, height: 22,
                        action: 'examine_genkan_skeleton',
                        description: 'éª¸éª¨'
                    }
                ]
            },
            living: {
                name: 'å±…é–“',
                description: 'è’å»ƒã—ãŸãƒªãƒ“ãƒ³ã‚°ã ã€‚å£ã«å†™çœŸãŒãŸãã•ã‚“é£¾ã‚‰ã‚Œã¦ã„ã‚‹ã€‚ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸Šã«éµãŒã‹ã‹ã£ãŸå°ç®±ãŒã‚ã‚‹',
                clickableAreas: [
                    {
                        x: 9, y: 25, width: 5, height: 8,
                        action: 'examine_living_pic1',
                        description: 'å¤ã„å†™çœŸ'
                    },
                    {
                        x: 17, y: 31, width: 4, height: 10.6,
                        action: 'examine_living_pic2',
                        description: 'å¤ã„å†™çœŸ'
                    },
                    {
                        x: 3.7, y: 40.8, width: 4.7, height: 8,
                        action: 'examine_living_pic3',
                        description: 'å¤ã„å†™çœŸ'
                    },
                    {
                        x: 10.5, y: 43.5, width: 4.7, height: 5,
                        action: 'examine_living_pic4',
                        description: 'å¤ã„å†™çœŸ'
                    },
                    {
                        x: 15.5, y: 49.4, width: 5.2, height: 4.2,
                        action: 'examine_living_pic5',
                        description: 'å¤ã„å†™çœŸ'
                    },
                    {
                        x: 37, y: 69, width: 7.5, height: 5.4,
                        action: 'examine_living_box',
                        description: 'éµãŒã‹ã‹ã£ãŸå°ç®±'
                    },
                    {
                        x: 26.3, y: 40.7, width: 17.2, height: 5.3,
                        action: 'examine_living_books1',
                        description: 'æœ¬æ£š'
                    },
                    {
                        x: 26.4, y: 49, width: 16.6, height: 5.3,
                        action: 'examine_living_books2',
                        description: 'æœ¬æ£š'
                    },
                    {
                        x: 45.4, y: 72, width: 8, height: 2.4,
                        action: 'examine_living_books3',
                        description: 'ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸Šã®æœ¬'
                    },
                    {
                        x: 81.4, y: 43.5, width: 13.2, height: 39,
                        action: 'examine_living_skeleton',
                        description: 'éª¸éª¨'
                    },
                    {
                        x: 3.6, y: 56.6, width: 21.7, height: 23.3,
                        action: 'examine_living_sofa',
                        description: 'ã‚½ãƒ•ã‚¡'
                    },
                    {
                        x: 29, y: 75, width: 26, height: 12,
                        action: 'examine_living_table',
                        description: 'ãƒ†ãƒ¼ãƒ–ãƒ«'
                    },
                    {
                        x: 90.2, y: 61.4, width: 1.7, height: 1.4,
                        action: 'examine_living_lapel',
                        description: 'ï¼Ÿ'
                    }
                ]
            },
            corridor: {
                name: 'å»Šä¸‹',
                description: 'è±ªè¯ã ãŒè’å»ƒã—ãŸå»Šä¸‹',
                clickableAreas: [
                    {
                        x: 43, y: 37, width: 18, height: 40,
                        action: 'examine_corridor_door',
                        description: 'å¥¥ã®ãƒ‰ã‚¢'
                    },
                    {
                        x: 73, y: 38, width: 12, height: 34,
                        action: 'examine_corridor_skeleton',
                        description: 'éª¸éª¨'
                    },
                    {
                        x: 91, y: 10, width: 8, height: 36,
                        action: 'examine_corridor_picture_right',
                        description: 'å¥³æ€§ã®è‚–åƒç”»'
                    },
                    {
                        x: 28, y: 41.5, width: 9, height: 14,
                        action: 'examine_corridor_picture_center',
                        description: 'è‹¥ã„ç”·æ€§ã®è‚–åƒç”»'
                    },
                    {
                        x: 4.3, y: 14.6, width: 6.4, height: 33.6,
                        action: 'examine_corridor_picture_left',
                        description: 'ä¸­å¹´å¥³æ€§ã®è‚–åƒç”»'
                    },
                    {
                        x: 45, y: 10, width: 17, height: 13,
                        action: 'examine_corridor_light',
                        description: 'ã‚·ãƒ£ãƒ³ãƒ‡ãƒªã‚¢'
                    },
                    {
                        x: 2, y: 52, width: 17, height: 36,
                        action: 'examine_corridor_chair',
                        description: 'å¤ã³ãŸè±ªè¯ãªæ¤…å­'
                    },
                    {
                        x: 18.6, y: 62, width: 4.6, height: 3,
                        action: 'examine_corridor_drawer1',
                        description: 'å¼•ãå‡ºã—',
                        zIndex:5
                    },
                    {
                        x: 18.2, y: 69, width: 5, height: 3,
                        action: 'examine_corridor_drawer2',
                        description: 'å¼•ãå‡ºã—',
                        zIndex:5
                    }
                ]
            },
            dining: {
                name: 'é£Ÿå ‚',
                description: 'é£Ÿå ‚',
                clickableAreas: [
                    {
                        x: 10, y: 27, width: 14.5, height: 42,
                        action: 'examine_dining_skeleton',
                        description: 'éª¸éª¨'
                    },
                    {
                        x: 52.5, y: 42, width: 8.5, height: 7,
                        action: 'examine_kannuki',
                        description: 'ã•ã³ä»˜ã„ãŸã‹ã‚“ã¬ã',
                        zIndex:5
                    },
                    {
                        x: 85.4, y: 20, width: 11, height: 10,
                        action: 'examine_dining_right_dish1',
                        description: 'é£¾ã‚Šçš¿'
                    },
                    {
                        x: 87, y: 36, width: 8.7, height: 7,
                        action: 'examine_dining_right_dish2',
                        description: 'é£¾ã‚Šçš¿'
                    },
                    {
                        x: 60, y: 70, width: 13, height: 8,
                        action: 'examine_dining_under_table',
                        description: 'ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸‹'
                    },
                    {
                        x: 56, y: 51, width: 4, height: 9,
                        action: 'examine_pot',
                        description: 'ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸Šã®ãƒãƒƒãƒˆ'
                    }
                ]
            },
            end: {
                name: 'å¤–ã®ä¸–ç•Œã¸ãƒ«ãƒ¼ãƒˆ',
                description: 'ã‚ãªãŸã¯ç„¡äº‹è„±å‡ºã§ãã¾ã—ãŸã€‚ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™',
                clickableAreas: [
                    {
                        x: 0, y: 0, width: 100, height: 100,
                        action: 'examine_end',
                        description: 'å¤–ã®ä¸–ç•Œ'
                    },
                ]
            },
            trueEnd: {
                name: 'å¤¢ã®ä¸–ç•Œã¸ãƒ«ãƒ¼ãƒˆ',
                description: 'ã‚ãªãŸã¯éª¸éª¨åŸ·äº‹ã¨ã¨ã‚‚ã«ã€å¤¢ã®ä¸–ç•Œã¸æ—…ç«‹ã£ãŸ',
                clickableAreas: [
                    {
                        x: 0, y: 0, width: 100, height: 100,
                        action: 'examine_true_end',
                        description: 'å¤¢ã®ä¸–ç•Œ'
                    },
                ]
            },
        };

        const hintMessages = {
            genkan: {
                skeleton: [
                "ã“ã‚Œã¯ã€çã—ã„ãŠå®¢ã•ã‚“ã§ã™ãª",
                "ãŠå›°ã‚Šãªã‚‰å¼µã‚Šç´™ã‚’è¦‹ã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚",
                "ãã‚Œä»¥ä¸Šãƒ’ãƒ³ãƒˆã¯â€¦éª¨ãŒæŠ˜ã‚Œã¾ã™ã€‚"
                ]
            },
            corridor: {
                skeleton: [
                "ä»£ã€…ã®ã”å®¶æ—ã®è‚–åƒç”»ã§ã™ã",
                "ãŠå›°ã‚Šãªã‚‰èª¿ã¹ã¦ã¿ã‚‹ã®ã‚‚è‰¯ã„ã‚‚ã—ã‚Œã¾ã›ã‚“ãª",
                "ãã‚Œã«ã—ã¦ã‚‚å¯’ã•ãŒéª¨èº«ã«ã—ã¿ã¾ã™ãªâ€¦"
                ],
                pic_center: [
                    "ã‚„ã‚ã€ç§ã¯ã‚¸ã‚§ã‚¤ãƒ ã‚ºã€‚ã“ã®å®¶ã®ä¸‰ä»£ç›®ã•ã€‚",
                    "å­ã©ã‚‚ã®é ƒã¯ã€ãƒ‰ãƒ­ã‚·ãƒ¼ãŠã°ã•ã‚“ã«ã‚ˆãéŠã‚“ã§ã‚‚ã‚‰ã£ãŸãªã‚ã€‚",
                    "ã‚­ãƒ£ãƒ­ãƒƒãƒˆã‚±ãƒ¼ã‚­ã€ç¾å‘³ã—ã‹ã£ãŸãªã‚ã€‚",
                ],
                pic_left: [
                    "ã¾ã‚ã€ã”ãã’ã‚“ã‚ˆã†ã€‚ã‚ãŸãã—ã¯ã‚¢ãƒ¡ãƒªã‚¢ã‚ˆã€‚",
                    "æœ€è¿‘ã¯ã€ãŠå±‹æ•·ã‚‚å¯‚ã‚Œã¦ãã¦ã—ã¾ã£ãŸã‚ã­ã€‚",
                    "å­ã©ã‚‚ã®é ƒã€æ¯ã‹ã‚‰ã€ã“ã®å®¶ã¯ã‹ã¤ã¦æ „ãˆã¦ã„ãŸã®ã‚ˆã€ã¨èã‹ã•ã‚ŒãŸã‚‚ã®ã‚ˆã€‚",
                ],
                pic_right: [
                    "ãƒã‚¤ã€ç§ã¯ãƒ‰ãƒ­ã‚·ãƒ¼ã‚ˆã€‚",
                    "ç§ã®æ™‚ä»£ã¯ã€èˆè¸ä¼šã‚‚é–‹ã‹ã‚Œã¦ã„ãŸã®ã‚ˆã€‚",
                    "ãã†ã„ãˆã°è«‹æ±‚æ›¸ãŒå¼•ãå‡ºã—ã«â€¦",
                ]
            },
            dining: {
                skeleton: [
                "ã«ãã‚„ã‹ãªé£Ÿå“ãŒæ‡ã‹ã—ã„ã§ã™ã­",
                "ãŠçš¿ã‚’ã‚ˆãè¦‹ã‚‹ã®ãŒã€ã“ã®å®¶ã®ãƒ«ãƒ¼ãƒ«ã§ã™ã€‚",
                "ã‚¸ãƒ£ãƒ æ´¾ã‹ã‚ªã‚¤ãƒ«æ´¾ã‹ã€ã“ã“ã¯åˆ†ã‹ã‚Œé“ã§ã™ã­â€¦"
                ]
            },
            living: {
                skeleton : [
                    "ãƒ€ãƒ¼ãƒ„ãŒãŠå¥½ãã ã£ãŸã®ã¯ã€ã¯ã¦ã€ã©ãªãŸã ã£ãŸã‹â€¦",
                    "ãªãœã‹ã€ã€Œå…ˆä»£ãŸã¡ã®åã‚’ä¸¦ã¹ã‚ˆã€ã¨ã„ã†è¨€è‘‰ãŒç¹°ã‚Šè¿”ã—é ­ã«æµ®ã‹ã¶ã®ã§ã™",
                    "ç§ã¯ä½•ãŒå¥½ãã ã£ãŸã®ã§ã—ã‚‡ã†â€¦æ€ã„å‡ºã›ã¾ã›ã‚“",
                ]
            }
            // å¿…è¦ãªã‚‰ä»–ã®éƒ¨å±‹ã‚„ã‚­ãƒ£ãƒ©ã‚‚è¿½åŠ 
        };

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initGame() {
            changeRoom('genkan');
            updateMessage('æ°—ãŒä»˜ãã¨ã‚ãªãŸã¯å¤ã„æ´‹é¤¨ã«ç«‹ã£ã¦ã„ã¾ã—ãŸã€‚ç„é–¢ãƒ‰ã‚¢ã¯ã‚«ã‚®ãŒã‹ã‹ã£ã¦ã„ã¦å‡ºã‚‰ã‚Œã¾ã›ã‚“');
        }

        // éƒ¨å±‹ã‚’å¤‰æ›´
        function changeRoom(roomId) {
            gameState.currentRoom = roomId;
            const room = rooms[roomId];
            
            // èƒŒæ™¯ç”»åƒã‚’è¨­å®šï¼ˆç”»åƒãŒãªã„å ´åˆã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
            const roomView = document.getElementById('roomView');
            roomView.style.backgroundImage = `url(${IMAGES.rooms[roomId]})`;
            
            // ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã‚¨ãƒªã‚¢ã‚’ç”Ÿæˆ
            generateClickableAreas(room);
            
            updateMessage(`${room.name}ã«å…¥ã‚Šã¾ã—ãŸã€‚${room.description}`);
        }

        // èƒŒæ™¯ç”»åƒã‚’å·®ã—æ›¿ãˆ
        function changeRoomImage(roomId) {
            gameState.currentRoom = roomId;
            const room = rooms[roomId];
            
            // èƒŒæ™¯ç”»åƒã‚’è¨­å®šï¼ˆç”»åƒãŒãªã„å ´åˆã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
            const roomView = document.getElementById('roomView');
            roomView.style.backgroundImage = `url(${IMAGES.rooms[roomId]})`;
            generateClickableAreas(room);
        }

        // ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã‚¨ãƒªã‚¢ã‚’ç”Ÿæˆ
        // 
        function generateClickableAreas(room) {
            const roomView = document.getElementById('roomView');

            roomView.innerHTML = '<img id="roomImage" src="'+IMAGES.rooms[gameState.currentRoom]+'" style="width:100%;height:100%;object-fit:contain;position:absolute;left:0;top:0;">';

            // ç”»åƒã®ãƒ­ãƒ¼ãƒ‰å¾Œã«é…ç½®
            const img = roomView.querySelector('#roomImage');
            img.onload = function() {

                room.clickableAreas.forEach(area => {
                    const clickableDiv = document.createElement('div');
                    clickableDiv.className = 'clickable-area';
                    clickableDiv.style.left   = (area.x) + '%';
                    clickableDiv.style.top    = (area.y) + '%';
                    clickableDiv.style.width  = (area.width) + '%';
                    clickableDiv.style.height = (area.height) + '%';
                    clickableDiv.style.position = 'absolute';
                    clickableDiv.style.zIndex = area.zIndex || 1;
                    clickableDiv.onclick = () => handleAreaClick(area.action);
                    clickableDiv.title = area.description;

                    roomView.appendChild(clickableDiv);
                });
            };
            img.src = IMAGES.rooms[gameState.currentRoom]; // å¿…ãšç”»åƒã‚»ãƒƒãƒˆ
        }

        // ã‚¨ãƒªã‚¢ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function handleAreaClick(action) {
            switch(action) {
                case 'examine_genkan_door':
                    if (gameState.flags.foundGenkanKey) {
                        updateMessage('ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢');
                    } else {
                         updateMessage('ç„é–¢ãƒ‰ã‚¢ã«ã¯éµãŒã‹ã‹ã£ã¦ã„ã‚‹');
                    }
                     break;
                case 'examine_genkan_key':
                    updateMessage('é–‹ã‘ã‚‰ã‚Œãã†ã«ãªã„');
                    break;
                case 'examine_genkan_paper':
                    updateMessage('å¨˜ã®èª•ç”Ÿæ—¥ã€ã¨æ›¸ã„ã¦ã‚ã‚‹');
                    gameState.genkan.flags.watchedPaper = true;
                    break;
                case 'examine_genkan_chair':
                    updateMessage('æ¤…å­ã«åº§ã£ã¦ã¿ãŸã€‚ä½•ã‹ãŒãã—ã‚€ã‚ˆã†ãªéŸ³ãŒã™ã‚‹â€¦');
                    playSE('se-metal');
                    break;
                case 'examine_genkan_left_door':
                    updateMessage('ç•ªå·å¼ã®ã‚«ã‚®ãŒã‹ã‹ã£ã¦ã„ã‚‹');
                    showGenkanPuzzle();
                    break;
                case 'examine_genkan_picture':
                    if (gameState.genkan.flags.watchedPaper) {
                        updateMessage('ã“ã‚ŒãŒå¨˜ã ã‚ã†ã‹ï¼Ÿ18æ­³è¨˜å¿µã®è‚–åƒç”»ã®ã‚ˆã†ã ã€‚è£½ä½œå¹´ã¯2006ã¨æ›¸ã„ã¦ã‚ã‚‹');
                        
                    } else {
                        updateMessage('è‹¥ã„å¥³æ€§ã®è‚–åƒç”»ã ');
                    }
                    
                    break;  
                case 'examine_genkan_memo':
                    updateMessage('ä½•ã‹ã®ãƒ¡ãƒ¢ã®ã‚ˆã†ã ã€‚ã€Œ8/1ã€€æ˜å¾Œæ—¥ã¯å¨˜ã®èª•ç”Ÿæ—¥ã ã€‚è¡—ã®æ´‹è“å­åº—ã§ç‰¹è£½ãƒãƒ¼ã‚ºã‚±ãƒ¼ã‚­ã‚’äºˆç´„ã—ãªãã¦ã¯ã€');
                    break; 
                case 'examine_genkan_spidernet':
                    updateMessage('ã‚¯ãƒ¢ã®å·£ãŒå¼µã£ã¦ã„ã‚‹â€¦');
                    break; 
                case 'examine_genkan_pin':
                    if (!gameState.genkan.flags.foundPin) {
                        updateMessage('å¤ã³ãŸãƒ”ãƒ³ãƒ–ãƒ­ãƒ¼ãƒã ');
                        showModal(
                            'å®¶å…·ã®ä¸‹ã«ä½•ã‹è½ã¡ã¦ã„ã‚‹â€¦<br>å°ã•ãªãƒ”ãƒ³ãƒ–ãƒ­ãƒ¼ãƒã ',
                            '<img src="images/pin.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                            [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                        );  
                        addItem('pin'); 
                    } else {
                        updateMessage('ä½•ã‚‚ãªã„');
                    }
                    
                    break;  
                case 'examine_genkan_skeleton':
                    talkToHintCharacter('genkan','skeleton');
                    playSE('se-skeleton');
                    break; 
                // living
                case 'examine_living_skeleton':
                    talkToHintCharacter('living','skeleton');
                    playSE('se-skeleton');
                    break; 
                
                case 'examine_living_pic1':
                    updateMessage('ç”·æ€§ã®å†™çœŸã ã€‚ãƒ€ãƒ¼ãƒ„ã®çŸ¢ã‚’æ§‹ãˆã¦ã„ã‚‹ã€‚ã€ŒMartinã€€ãƒãƒ¼ãƒ†ã‚£ãƒ³ã€');
                    break;
                case 'examine_living_pic2':
                    updateMessage('ä¸­å¹´ã®å¥³æ€§ã®å†™çœŸã ã€‚ã€ŒDOROTHYã€€ãƒ‰ãƒ­ã‚·ãƒ¼ã€');
                    break;
                case 'examine_living_pic3':
                    updateMessage('è‹¥ã„å¥³æ€§ã®å†™çœŸã ã€‚ãƒãƒ©ã®èŠ±ã‚’æŒã£ã¦ã„ã‚‹ã€‚ã€ŒAmeliaã€€ã‚¢ãƒ¡ãƒªã‚¢ã€');
                    break;
                case 'examine_living_pic4':
                    updateMessage('å£®å¹´ç”·æ€§ã®å†™çœŸã ã€‚ã€ŒEdwardã€€ã‚¨ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã€');
                    break;
                case 'examine_living_pic5':
                    updateMessage('è‹¥ã„å¥³æ€§ã®å†™çœŸã ã€‚å¸½å­ã‚’ã‹ã¶ã£ã¦ã„ã‚‹ã€‚ã€ŒRachelã€€ãƒ¬ã‚¤ãƒã‚§ãƒ«ã€');
                    break;
                case 'examine_living_books1':
                    updateMessage('å¤ã„æ—¥è¨˜ã‚’è¦‹ã¤ã‘ãŸã€‚ã€Œ2001å¹´7æœˆ3æ—¥ã€€ãƒ€ãƒ¼ãƒ„ã®å¤§ä¼šã§æº–å„ªå‹ã€‚ç·´ç¿’ã—ãŸã‹ã„ãŒã‚ã£ãŸï¼ã€');
                    break;  
                case 'examine_living_books2':
                    showModal(
                        'ãƒ¡ãƒ¢ãŒæŒŸã¾ã£ã¦ã„ã‚‹ã€‚',
                        '<img src="images/living_memo1.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                        [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                    );
                    break;   
                case 'examine_living_books3':
                    updateMessage('ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸Šã«ã¯1å†Šã®æœ¬ãŒã‚ã‚‹ã€‚ã€Œè©³èª¬ï¼šãƒ›ãƒ¼ãƒ ãƒ¡ãƒ¼ãƒ‰ã‚¹ã‚¤ãƒ¼ãƒ„ã®ä½œã‚Šæ–¹ã€ãƒ‰ãƒ­ã‚·ãƒ¼ã¨ã‚µã‚¤ãƒ³ãŒå…¥ã£ã¦ã„ã‚‹');
                    break;  
                case 'examine_living_table':
                    showModal(
                        'ç«‹æ´¾ãªãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸‹ã«ãƒ¡ãƒ¢ãŒè½ã¡ã¦ã„ãŸã€‚',
                        '<img src="images/living_memo2.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                        [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                    );
                    break; 
                case 'examine_living_sofa':
                    updateMessage('ã€Œã©ã†ãã©ã†ãã€ãŠã‹ã‘ãã ã•ã„ã€‚å¤¢ã®ã‚ˆã†ãªåº§ã‚Šå¿ƒåœ°ã§ã™ã‚ˆã€');
                    playSE('se-skeleton');
                    break; 
                case 'examine_living_lapel':
                    if (gameState.selectedItem=='pin') {
                        updateMessage('ã€Œãªã‚“ã¨ã€ç§ã«ä¸‹ã•ã‚‹ã®ã§ã™ã‹ï¼Ÿã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã€');
                        playSE('se-skeleton');
                        showModal(
                            'ã€Œãªã‚“ã¨ã€ç§ã«ä¸‹ã•ã‚‹ã®ã§ã™ã‹ï¼Ÿã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€',
                            '<img src="images/skeleton-favor.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                            [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                        );
                        removeItem('pin');
                        gameState.flags.skeletonFavor++;
                    } else {
                        updateMessage('ã€Œã©ã†ã‹ã—ã¾ã—ãŸã‹ãªï¼Ÿã€');
                    }
                    break; 
                // corridor
                case 'examine_corridor_door':
                    if (gameState.corridor.flags.talkToLeft && gameState.corridor.flags.talkToCenter && gameState.corridor.flags.talkToRight) {
                        showCorridorPuzzle();
                    }
                    else {
                        updateMessage('ãƒ‰ã‚¢ã«ã¯éµãŒã‹ã‹ã£ã¦ã„ã‚‹');
                    }
                    break;
                case 'examine_corridor_skeleton':
                    talkToHintCharacter('corridor','skeleton');
                    playSE('se-skeleton');
                    break; 
                case 'examine_corridor_picture_left':
                    talkToHintCharacter('corridor','pic_left');
                    playSE('se-skeleton');
                    gameState.corridor.flags.talkToLeft = true;
                    break;  
                case 'examine_corridor_picture_center':
                    talkToHintCharacter('corridor','pic_center');
                    gameState.corridor.flags.talkToCenter = true;
                    playSE('se-skeleton');
                    break;  
                case 'examine_corridor_picture_right':
                    talkToHintCharacter('corridor','pic_right');
                    gameState.corridor.flags.talkToRight = true;
                    playSE('se-skeleton');
                    break;    
                case 'examine_corridor_light':
                    updateMessage('å¤ã³ãŸç…§æ˜ã ã€‚é«˜ä¾¡ãã†ãªé›°å›²æ°—ã ');
                    break;
                case 'examine_corridor_drawer1':
                    updateMessage('è«‹æ±‚æ›¸ãŒã‚ã‚‹ã€‚ã€Œ1967/3/4ã€€ãƒ›ãƒ­ãƒ³å®¶ã®ãƒ‰ãƒ­ã‚·ãƒ¼æ§˜ã€‚æœé£¾ä»£ã¨ã—ã¦5900ã‚´ãƒ¼ãƒ«ãƒ‰ã‚’è«‹æ±‚ã„ãŸã—ã¾ã™ã€');
                    break;  
                case 'examine_corridor_drawer2':
                    if (gameState.selectedItem=='drawerKey' && !hasItem('coin')) {
                        updateMessage('ã‚³ã‚¤ãƒ³ã‚’ã¿ã¤ã‘ãŸ');
                        addItem('coin');
                        removeItem('drawerKey');
                        gameState.corridor.flags.useDrawerKey = true;
                    } else if(gameState.corridor.flags.useDrawerKey) {
                        updateMessage('å†™çœŸãŒã‚ã‚‹ã€‚è£ã«ã¯ã€Œ2000/10/21 ã‚¢ãƒ¡ãƒªã‚¢ã¨ãƒªãƒãƒ£ãƒ¼ãƒ‰ã€ã¨æ›¸ã„ã¦ã‚ã‚‹');
                    } else {
                        updateMessage('éµãŒã‹ã‹ã£ã¦ã„ã¦é–‹ã‹ãªã„');
                    }
                    break;  
                case 'examine_corridor_chair': 
                    if(!gameState.corridor.flags.foundDrawerKey) {
                        updateMessage('ãµã‹ãµã‹ã¨ã—ãŸæ¤…å­ã ');  
                        showModal(
                            'åº§ã£ã¦ã¿ã‚‹ã¨ãŠå°»ã«å›ºã„ã‚‚ã®ãŒå½“ãŸã‚‹â€¦<br>å¼µã‚Šåœ°ã®ç ´ã‚Œç›®ã‹ã‚‰æŒ‡ã‚’å…¥ã‚Œã‚‹ã¨ä½•ã‹ãŒã‚ã‚‹ã€‚<br>å°ã•ãªéµã‚’æ‰‹ã«å…¥ã‚ŒãŸã€‚',
                            '<img src="images/drawerKey.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                            [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                        );  
                        addItem('drawerKey');
                        gameState.corridor.flags.foundDrawerKey = true;
                    } else {
                        updateMessage('ãµã‹ãµã‹ã¨ã—ãŸæ¤…å­ã ');   
                    }
                    
                    break;  
                // dining
                case 'examine_dining_skeleton':
                    if (gameState.selectedItem=='oil') {
                        updateMessage('ã€Œã“ã‚Œã¯ã“ã‚Œã¯ï¼éª¨ã«è‰¯ã•ãã†ãªã‚ªã‚¤ãƒ«ã§ã™ãªã€‚ã‚ã‚ŠãŒãŸãã„ãŸã ãã¾ã™ã€'); 
                        playSE('se-skeleton');
                        removeItem('oil');
                        gameState.flags.skeletonFavor++;
                    } else {
                        talkToHintCharacter('dining','skeleton');
                        playSE('se-skeleton');
                    }
                    
                    break; 
                case 'examine_dining_under_table': 
                    if(!gameState.dining.flags.foundJam) {
                        updateMessage('ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸‹ã«ã‚¸ãƒ£ãƒ ã®ç“¶ãŒè½ã¡ã¦ã„ãŸã€‚æœªé–‹å°ã ã€‚æœå®Ÿã®é¦™ã‚ŠãŒã»ã®ã‹ã«ã™ã‚‹ã€‚ä½¿ã„é“ã¯â€¦ãƒ‘ãƒ³ä»¥å¤–ã«ã‚‚ï¼Ÿ');    
                        showModal(
                            'ã‚¸ãƒ£ãƒ ã®ç“¶ï¼ˆä¸­èº«å…¥ã‚Šï¼‰ã‚’æ‰‹ã«å…¥ã‚ŒãŸã€‚',
                            '<img src="images/jam.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                            [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                        );  
                        addItem('jam');
                        gameState.dining.flags.foundJam = true;
                    } else {
                        updateMessage('ä½•ã‚‚ãªã„');   
                    }
                    
                    break;  
                case 'examine_pot': 
                    if(!hasItem('oil')) {
                        updateMessage('ãƒãƒƒãƒˆã®ä¸­èº«ã¯ãªã«ã‹ã®ã‚ªã‚¤ãƒ«ã®ã‚ˆã†ã ã€‚ãªã‚“ã ã‹éª¨ã«ãƒ„ãƒ¤ãŒå‡ºãã†ãªã‚ªã‚¤ãƒ«ã ');   
                        showModal(
                            'ã‚³ãƒƒãƒ—ã«ã‚ªã‚¤ãƒ«ã‚’å…¥ã‚ŒãŸ',
                            '<img src="images/oil.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                            [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                        );   
                        addItem('oil');
                        gameState.corridor.flags.foundOil = true;
                    } else {
                        updateMessage('ãƒãƒƒãƒˆã®ä¸­ã«ã¯æ²¹ã®ã‚ˆã†ãªæ¶²ä½“ãŒå…¥ã£ã¦ã„ã‚‹');   
                    }
                    
                    break;  
                case 'examine_dining_right_dish1':
                    if (gameState.selectedItem=='coin') {
                        // ãƒãƒƒãƒ‰ã‚¨ãƒ³ãƒ‰æ¼”å‡º
                        showModal(
                            'ãƒãƒƒãƒ‰ã‚¨ãƒ³ãƒ‰',
                            '<img src="images/badend.jpg" style="width:300px;display:block;margin:0 auto 20px;">' +
                            '<br>ã‚ãªãŸã¯ã‚¯ãƒã®å¦–ç²¾ã®ãŠçš¿ã‚’å‰²ã£ã¦ã—ã¾ã£ãŸâ€¦<br><b>å¤§äº‹ãªã‚‚ã®ã ã£ãŸã‚ˆã†ã ã€‚</b><br>ã‚ãªãŸã¯æ€’ã£ãŸéª¸éª¨ã«ã‚ˆã‚Šå°éƒ¨å±‹ã«ç›£ç¦ã•ã‚ŒãŸã€‚<span style="color:#f00;">ã€ãƒãƒƒãƒ‰ã‚¨ãƒ³ãƒ‰ã€‘</span>',
                            [{text: 'æœ€åˆã‹ã‚‰', action: 'restart'}]
                        );
                        playSE('se-parin');
                        break;
                    } else {
                        updateMessage('å¤ãã†ãªãŠçš¿ãŒé£¾ã‚‰ã‚Œã¦ã„ã‚‹ã€‚ã‚¯ãƒã®å¦–ç²¾ã®çµµãŒæ›¸ã‹ã‚Œã¦ãŠã‚Šã€å°‘ã—ã²ã³ãŒå…¥ã£ã¦ã„ã‚‹');
                    }
                    break; 
                case 'examine_dining_right_dish2':
                    updateMessage('å¤ãã†ãªãŠçš¿ãŒé£¾ã‚‰ã‚Œã¦ã„ã‚‹ã€‚1985ã¨å¹´å·ãŒæ›¸ã‹ã‚Œã¦ãŠã‚Šã€æ›ã‘é‡‘ãŒã‚†ã‚‹ã‚“ã§ã„ã‚‹');
                    break; 
                case 'examine_kannuki':
                    if (gameState.selectedItem=='oil') {
                        updateMessage('ã‚ªã‚¤ãƒ«ã§ã‹ã‚“ã¬ããŒå‹•ãã‚ˆã†ã«ãªã£ãŸï¼');
                        playSE('se-subclear');
                        showModal(
                            'ã‚ªã‚¤ãƒ«ã§ã‹ã‚“ã¬ããŒå‹•ãã‚ˆã†ã«ãªã£ãŸï¼',
                            '<img src="images/sub_clear.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                            [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                        );
                        removeItem('oil');
                        changeRoom('living');
                    } else if (gameState.selectedItem=='jam') {
                        updateMessage('ã‚¸ãƒ£ãƒ ã‚’å¡—ã£ã¦ã¿ã‚‹ã¨ã€ã‹ã‚“ã¬ããŒå‹•ãã‚ˆã†ã«ãªã£ãŸï¼');
                        playSE('se-subclear');
                        showModal(
                            'ã‚¸ãƒ£ãƒ ã‚’å¡—ã£ã¦ã¿ã‚‹ã¨ã€ã‹ã‚“ã¬ããŒå‹•ãã‚ˆã†ã«ãªã£ãŸï¼',
                            '<img src="images/sub_clear.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                            [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                        );
                        removeItem('jam');
                        changeRoom('living');
                    } else {
                        updateMessage('ã‹ã‚“ã¬ããŒã•ã³ä»˜ã„ã¦å‹•ã‹ãªã„');
                    }
                    break;
                case 'examine_insect':
                    updateMessage('ã‚´ã‚­ãƒ–ãƒªã®æ­»éª¸ãŒè½ã¡ã¦ã„ã‚‹ã€‚');
                    break;    
                case 'examine_living_box':
                    showFinalPuzzle();
                    break;
                
                case 'examine_end':
                    updateMessage('ã‚ãªãŸã¯å¤–ã¸ã¨è¶³ã‚’è¸ã¿å‡ºã—ã¾ã—ãŸã€‚ï¼ˆãƒãƒ¼ãƒãƒ«ã‚¨ãƒ³ãƒ‰ï¼‰');
                    break; 
                case 'examine_true_end':
                    updateMessage('ã‚ãªãŸã¯å¤¢ã®ä¸–ç•Œã§å¹¸ã›ã«æš®ã‚‰ã—ã¾ã—ãŸã€‚ï¼ˆãƒˆã‚¥ãƒ«ãƒ¼ã‚¨ãƒ³ãƒ‰ï¼‰');
                    break; 
            }
            gameState.selectedItem = null;
            gameState.selectedItemSlot = null;

            playSE('se-click');
            updateInventoryDisplay();
        }

        function talkToHintCharacter(roomId, charId) {
            // flagså–å¾—
            let flags = gameState[roomId].flags;
            // ã¾ã ã‚«ã‚¦ãƒ³ãƒˆç„¡ã‘ã‚Œã°åˆæœŸåŒ–
            if (!flags.talkTo) flags.talkTo = {};
            if (!flags.talkTo[charId]) flags.talkTo[charId] = 0;

            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
            flags.talkTo[charId]++;

            // ã‚»ãƒªãƒ•ãƒªã‚¹ãƒˆå–å¾—
            const messages = hintMessages[roomId][charId];
            // ç¯„å›²å¤–ãªã‚‰æœ€å¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const idx = (flags.talkTo[charId] - 1) % messages.length;

            // è¡¨ç¤º
            updateMessage(messages[idx]);
        }

        // ç„é–¢ãƒ‘ã‚ºãƒ«ã‚’è¡¨ç¤º
        function showGenkanPuzzle() {
            const modalContent = `
                <h3>å…¥åŠ›ãƒ‘ãƒãƒ«</h3>
                <p>å¨˜ã®èª•ç”Ÿæ—¥ã¯ï¼Ÿ</p>
                <input type="text" class="puzzle-input" id="genkanInput" placeholder="æ•°å­—ã‚’å…¥åŠ›ï¼ˆä¾‹:19990101ï¼‰">
                <br>
                <button onclick="checkGenkanPuzzle()">ç¢ºèª</button>
                <button onclick="closeModal()">é–‰ã˜ã‚‹</button>
            `;
            
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }

        // ç„é–¢ãƒ‘ã‚ºãƒ«ã®ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯
        function checkGenkanPuzzle() {
            const input = document.getElementById('genkanInput').value;
            if (input === 'ï¼‘ï¼™ï¼˜ï¼˜ï¼ï¼˜ï¼ï¼“' || input === '19880803') {
                closeModal();
                updateMessage('æ­£è§£ã§ã™ï¼ãƒ‰ã‚¢ãŒé–‹ãã¾ã—ãŸï¼');
                playSE('se-subclear');
                showModal(
                    'æ¬¡ã®éƒ¨å±‹ã¸ã®ãƒ‰ã‚¢ãŒé–‹ã„ãŸï¼',
                    '<img src="images/sub_clear.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                    [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                );
                changeRoom('corridor');

            } else {
                playSE('se-error');
                updateMessage('é•ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚');
            }
        }

        // å»Šä¸‹ã‚¯ã‚¤ã‚ºã‚’è¡¨ç¤º
        function showCorridorPuzzle() {
            const modalContent = `
                <h3>è¬ã®å£°ãŒéŸ¿ãâ€¦</h3>
                <p>ä¸€ç•ªã®å¤æ ªã®åã¯ï¼Ÿ</p>
                <input type="text" class="puzzle-input" id="corridorInput" placeholder="ã‚¢ãƒ¡ãƒªã‚¢orã‚¸ã‚§ã‚¤ãƒ ã‚ºorãƒ‰ãƒ­ã‚·ãƒ¼">
                <br>
                <button onclick="checkCorridorPuzzle()">ç¢ºèª</button>
                <button onclick="closeModal()">é–‰ã˜ã‚‹</button>
            `;
            
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }

        // å»Šä¸‹ã‚¯ã‚¤ã‚ºã®ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯
        function checkCorridorPuzzle() {
            const input = document.getElementById('corridorInput').value;
            if (input === 'ãƒ‰ãƒ­ã‚·ãƒ¼') {
                closeModal();
                updateMessage('æ­£è§£ã§ã™ï¼ä¸æ€è­°ãªåŠ›ã§éµãŒé–‹ãã¾ã—ãŸï¼');
                playSE('se-subclear');
                showModal(
                    'æ¬¡ã®éƒ¨å±‹ã¸ã®ãƒ‰ã‚¢ãŒé–‹ã„ãŸï¼',
                    '<img src="images/sub_clear.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                    [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                );
                changeRoom('dining');
                updateMessage('ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ã®ã‚ˆã†ã ');

            } else {
                playSE('se-error');
                updateMessage('é•ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚');
            }
        }

        // æœ€çµ‚ã‚¯ã‚¤ã‚ºã‚’è¡¨ç¤º
        function showFinalPuzzle() {
            const modalContent = `
                <h3>ç­”ãˆã‚’å…¥åŠ›</h3>
                <p>å…ˆç¥–ã®åã‚’ä¸¦ã¹ã‚ˆ</p>
                <input type="text" class="puzzle-input" id="finalInput" placeholder="ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã§">
                <br>
                <button onclick="checkFinalPuzzle()">ç¢ºèª</button>
                <button onclick="closeModal()">é–‰ã˜ã‚‹</button>
            `;
            
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('modal').style.display = 'flex';
        }

        // æœ€çµ‚ã‚¯ã‚¤ã‚ºã®ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯
        function checkFinalPuzzle() {
            const input = document.getElementById('finalInput').value;
            if (input === 'dream' || input === 'DREAM') {
                closeModal();
                
                playSE('se-clear');
                if (gameState.flags.skeletonFavor>0) {
                    showModal(
                        'â€¦â€¦ã‚ã‚ã€æ€ã„å‡ºã—ã¾ã—ãŸã€‚ç§ã®åã¯ãƒãƒ¼ãƒ†ã‚£ãƒ³ã€‚<br>ã‚ãªãŸã®ãŠã‹ã’ã§ã€ç§ã‚‚ã‚„ã£ã¨å¿ƒæ®‹ã‚Šã‹ã‚‰è§£æ”¾ã•ã‚Œã¾ã™ã€‚<br>ã•ã‚ã€ã¨ã‚‚ã«å¤¢ã®ä¸–ç•Œã¸â€¦',
                        '<img src="images/true_clear.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                        [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                    );
                    changeRoom('trueEnd');

                } else {
                    showModal(
                        'â€¦â€¦ã‚ã‚ã€æ€ã„å‡ºã—ã¾ã—ãŸã€‚ç§ã®åã¯ãƒãƒ¼ãƒ†ã‚£ãƒ³ã€‚<br>ã“ã®å±‹æ•·ã«â€œå¤¢ï¼ˆDREAMï¼‰â€ã‚’è¨—ã—ã¦ãã ã•ã£ã¦ã€<br>å¿ƒã‚ˆã‚Šæ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™',
                        '<img src="images/clear.jpg" style="width:300px;display:block;margin:0 auto 20px;">',
                        [{text: 'é–‰ã˜ã‚‹', action: 'close'}]
                    );
                    changeRoom('end');
                }
                

            } else {
                playSE('se-error');
                updateMessage('é•ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚');
            }
        }


        // ã‚¢ã‚¤ãƒ†ãƒ ç®¡ç†
        function addItem(itemId) {
            playSE('se-item');
            if (gameState.inventory.length < 5) {
                gameState.inventory.push(itemId);
                updateInventoryDisplay();
            }
        }

        function removeItem(itemId) {
            const index = gameState.inventory.indexOf(itemId);
            if (index !== -1) {
                gameState.inventory.splice(index, 1);
                gameState.selectedItem = null;
                gameState.selectedItemSlot = null;
                updateInventoryDisplay();
            }
            
        }

        function hasItem(itemId) {
            return gameState.inventory.includes(itemId);
        }

        function useItem(slotIndex) {
            if (gameState.inventory[slotIndex]) {
                const item = gameState.inventory[slotIndex];
                updateMessage(`${getItemName(item)}ã‚’é¸æŠã—ã¾ã—ãŸã€‚ä½¿ç”¨ã—ãŸã„å ´æ‰€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚`);
                gameState.selectedItem = item;
                gameState.selectedItemSlot = slotIndex;
                updateInventoryDisplay(); 
            }
        }

        function getItemName(itemId) {
            const names = {
                key: 'éµ',
                drawerKey: 'ã¡ã„ã•ãªéµ',
                oil: 'ã‚³ãƒƒãƒ—ã«å…¥ã£ãŸã‚ªã‚¤ãƒ«',
                jam: 'ã‚¸ãƒ£ãƒ ãŒå…¥ã£ãŸç“¶',
                coin: 'å¤ã„ã‚³ã‚¤ãƒ³',
                book: 'ã‚³ã‚°ãƒã®å¤§å†’é™ºã®çµµæœ¬',
                pin: 'å¤ã³ãŸãƒ”ãƒ³ãƒ–ãƒ­ãƒ¼ãƒ'
            };
            return names[itemId] || itemId;
        }

        // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªè¡¨ç¤ºæ›´æ–°
        function updateInventoryDisplay() {
            const slots = document.querySelectorAll('.inventory-slot');
            slots.forEach((slot, index) => {
                slot.innerHTML = '';
                if (gameState.inventory[index]) {
                    const img = document.createElement('img');
                    img.src = IMAGES.items[gameState.inventory[index]];
                    img.onerror = function() {
                        // ç”»åƒãŒèª­ã¿è¾¼ã‚ãªã„å ´åˆã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¡¨ç¤º
                        this.style.display = 'none';
                        const placeholder = document.createElement('div');
                        placeholder.className = 'image-placeholder';
                        placeholder.textContent = getItemName(gameState.inventory[index]);
                        placeholder.style.width = '60px';
                        placeholder.style.height = '60px';
                        slot.appendChild(placeholder);
                    };
                    slot.appendChild(img);
                }
                // â˜…é¸æŠä¸­ãªã‚‰selectedã‚¯ãƒ©ã‚¹è¿½åŠ 
                if (gameState.selectedItemSlot === index) {
                    slot.classList.add('selected');
                } else {
                    slot.classList.remove('selected');
                }
            });
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°
        function updateMessage(message) {
            document.getElementById('messageArea').innerHTML = message;
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        function showModal(title, content, buttons) {
            let modalHtml = `<h3>${title}</h3><p>${content}</p>`;
            buttons.forEach(button => {
                modalHtml += `<button onclick="${button.action === 'close' ? 'closeModal' : button.action === 'restart' ? 'restartGame()' : button.action}()">${button.text}</button>`;
            });
            
            document.getElementById('modalContent').innerHTML = modalHtml;
            document.getElementById('modal').style.display = 'flex';
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
        function restartGame() {
            gameState = {
                currentRoom: 'genkan',
                inventory: [],
                genkan: {
                    flags: {
                        talkTo: {
                            skeleton:0
                        },
                        watchedPaper: false,
                        foundPin: false,
                    }
                },
                corridor: {
                    flags: {
                        foundDrawerKey: false,
                        talkTo: {
                            skeleton:0,
                            pic_left:0,
                            pic_center:0,
                            pic_right:0
                        },
                        talkToLeft:false,
                        talkToCenter:false,
                        talkToRight: false,
                    }
                },
                dining: {
                    flags: {
                        foundOil: false,
                        foundJam: false,
                        useOilToSkeleton: false,
                    }
                },
                living: {
                    flags: {
                        readMemo: false,
                    }
                },
                flags: {
                    skeletonFavor :0,
                    foundFutonbo: false,
                    foundBear: false,
                    happyBear: false,
                    foundBook:false,
                },
                selectedItem: null,
                selectedItemSlot: null,
            };
            closeModal();
            initGame();
            updateInventoryDisplay();
        }

        let isBGMPlaying = false;   // â†ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å†ç”Ÿã—ã¦ãªã„
        let isBGMInitialized = false; // åˆå›ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šç”¨

        // åˆå›ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ã ã‘BGMã‚’å†ç”Ÿ
        function initBGMOnce() {
        if (!isBGMInitialized) {
            const bgm = document.getElementById('bgm');
            bgm.volume = 0.3;
            bgm.play();
            isBGMPlaying = true;
            isBGMInitialized = true;
            document.getElementById('bgm-toggle').textContent = "ğŸ”Š BGM";
        }
        }
        window.addEventListener('click', initBGMOnce, { once: true });

        function toggleBGM() {
        const bgm = document.getElementById('bgm');
        const btn = document.getElementById('bgm-toggle');
        if (!isBGMPlaying) {
            bgm.play();
            isBGMPlaying = true;
            btn.textContent = "ğŸ”Š BGM";
        } else {
            bgm.pause();
            isBGMPlaying = false;
            btn.textContent = "ğŸ”‡ BGM";
        }
        }

        function playSE(id) {
            const se = document.getElementById(id);
            se.currentTime = 0;
            se.play();
        }

        function saveGame() {
            localStorage.setItem('escapeGameState', JSON.stringify(gameState));
            const oldMsg = document.getElementById('messageArea').innerHTML;
            updateMessage('ã‚»ãƒ¼ãƒ–ã—ã¾ã—ãŸï¼');
            setTimeout(() => {
                updateMessage(oldMsg);
            }, 1500);
        }

        function loadGame() {
            const saved = localStorage.getItem('escapeGameState');
            if (saved) {
                gameState = JSON.parse(saved);
                // UIã‚„ç”»é¢ã‚’stateã«åˆã‚ã›ã¦å¾©å…ƒã™ã‚‹
                changeRoom(gameState.currentRoom);
                updateInventoryDisplay();
                updateMessage('ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼');
            } else {
                updateMessage('ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
            }
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        initGame();
    </script>
</body>
</html>