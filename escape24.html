<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãªããªãã®æ‘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const villagers = [
            {
                id: 1,
                name: 'ãƒ‘ãƒ³å±‹ã®ãŠã˜ã•ã‚“',
                problem: 'å°éº¦ç²‰ãŒè¶³ã‚Šãªãã¦å›°ã£ã¦ã„ã‚‹',
                riddle: 'æœã¯4æœ¬è¶³ã€æ˜¼ã¯2æœ¬è¶³ã€å¤œã¯3æœ¬è¶³ã€‚ã“ã‚Œãªãƒ¼ã‚“ã ?',
                answer: 'äººé–“',
                hint: 'ãƒ’ãƒ³ãƒˆ: äººã®ä¸€ç”Ÿã‚’è€ƒãˆã¦ã¿ã¦',
                celebration: 'ã‚ã‚ŠãŒã¨ã†!ç¾å‘³ã—ã„ãƒ‘ãƒ³ã‚’ç„¼ã„ã¦å®´ä¼šã«æŒã£ã¦ã„ãã‚ˆ!'
            },
            {
                id: 2,
                name: 'èŠ±å±‹ã®ãŠã°ã•ã‚“',
                problem: 'èŠ±ãŒå…ƒæ°—ãŒãªãã¦æ‚©ã‚“ã§ã„ã‚‹',
                riddle: 'å£ã¯ã‚ã‚‹ã‘ã©é£Ÿã¹ã‚‰ã‚Œãªã„ã€é ­ã¯ã‚ã‚‹ã‘ã©è€ƒãˆã‚‰ã‚Œãªã„ã€‚ã“ã‚Œãªãƒ¼ã‚“ã ?',
                answer: 'å·',
                hint: 'ãƒ’ãƒ³ãƒˆ: æ°´ã«é–¢ä¿‚ã™ã‚‹ã‚‚ã®',
                celebration: 'èŠ±ãŒå…ƒæ°—ã«ãªã£ãŸã‚!ç´ æ•µãªèŠ±æŸã‚’ä½œã£ã¦åºƒå ´ã‚’é£¾ã‚‹ã‚ã­!'
            },
            {
                id: 3,
                name: 'å¤§å·¥ã®ãŠå…„ã•ã‚“',
                problem: 'é“å…·ã‚’ãªãã—ã¦å›°ã£ã¦ã„ã‚‹',
                riddle: 'éƒ¨å±‹ã®ä¸­ã«ã‚ã‚‹ã‘ã©ã€éƒ¨å±‹ã®å¤–ã«ã‚‚ã‚ã‚‹ã€‚ã“ã‚Œãªãƒ¼ã‚“ã ?',
                answer: 'çª“',
                hint: 'ãƒ’ãƒ³ãƒˆ: éƒ¨å±‹ã¨å¤–ã‚’ã¤ãªãã‚‚ã®',
                celebration: 'é“å…·ãŒè¦‹ã¤ã‹ã£ãŸ!å®´ä¼šç”¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹ã!'
            },
            {
                id: 4,
                name: 'æ–™ç†äººã®å¥³æ€§',
                problem: 'ãƒ¬ã‚·ãƒ”ã‚’æ€ã„å‡ºã›ãªãã¦å›°ã£ã¦ã„ã‚‹',
                riddle: 'ç«ã‚‚ä½¿ã‚ãšã€æ°´ã‚‚ä½¿ã‚ãšã€ãã‚Œã§ã‚‚æ–™ç†ãŒã§ãã‚‹ã€‚ã“ã‚Œãªãƒ¼ã‚“ã ?',
                answer: 'ç ‚',
                hint: 'ãƒ’ãƒ³ãƒˆ: å­ä¾›ãŒéŠã¶ã¨ãã«ä½¿ã†ã‚‚ã®',
                celebration: 'ãƒ¬ã‚·ãƒ”ã‚’æ€ã„å‡ºã—ãŸã‚!è±ªè¯ãªæ–™ç†ã‚’ä½œã£ã¦æŒã£ã¦ã„ãã‚ã­!'
            },
            {
                id: 5,
                name: 'éŸ³æ¥½å®¶ã®é’å¹´',
                problem: 'æ¥½å™¨ã®éŸ³ãŒå‡ºãªãã¦å›°ã£ã¦ã„ã‚‹',
                riddle: 'å©ã‘ã°å©ãã»ã©å–œã¶ã‚‚ã®ã€‚ã“ã‚Œãªãƒ¼ã‚“ã ?',
                answer: 'å¤ªé¼“',
                hint: 'ãƒ’ãƒ³ãƒˆ: æ¥½å™¨ã®ä¸€ç¨®',
                celebration: 'æ¥½å™¨ãŒç›´ã£ãŸ!å®´ä¼šã§ç´ æ•µãªéŸ³æ¥½ã‚’æ¼”å¥ã™ã‚‹ã‚ˆ!'
            }
        ];

        let currentScreen = 'village';
        let selectedHouse = null;
        let solvedRiddles = {};
        let userAnswer = '';
        let showFeedback = null;

        function isAllSolved() {
            return villagers.every(v => solvedRiddles[v.id]);
        }

        function createHouse(number, solved) {
            const bgColor = solved ? 'bg-yellow-400' : 'bg-amber-700';
            const checkMark = solved ? '<div class="absolute -top-2 -right-2 bg-green-500 rounded-full p-1 w-6 h-6 flex items-center justify-center text-white font-bold">âœ“</div>' : '';
            
            return `
                <div class="relative cursor-pointer transform transition-all hover:scale-110" onclick="openHouse(${number})">
                    <div class="w-24 h-24 ${bgColor} rounded-t-lg relative">
                        <div style="position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 48px solid transparent; border-right: 48px solid transparent; border-bottom: 30px solid #dc2626;"></div>
                        <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 w-8 h-10 bg-amber-900 rounded"></div>
                        ${checkMark}
                    </div>
                    <div class="text-center text-sm mt-1 font-bold">${number}</div>
                </div>
            `;
        }

        function renderVillageScreen() {
            const solvedCount = Object.keys(solvedRiddles).length;
            const allSolved = isAllSolved();
            const plazaButtonClass = allSolved 
                ? 'bg-yellow-400 hover:bg-yellow-500 text-amber-900 animate-pulse' 
                : 'bg-gray-300 text-gray-600 cursor-not-allowed';

            return `
                <div class="min-h-screen bg-gradient-to-b from-sky-300 to-green-200 p-8">
                    <h1 class="text-4xl font-bold text-center mb-2 text-amber-900">ãªããªãã®æ‘</h1>
                    <p class="text-center mb-8 text-gray-700">å®¶ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä½æ°‘ã‚’åŠ©ã‘ã‚ˆã†!</p>
                    
                    <div class="max-w-4xl mx-auto">
                        <div class="grid grid-cols-3 gap-12 mb-16">
                            ${createHouse(1, solvedRiddles[1])}
                            ${createHouse(2, solvedRiddles[2])}
                            ${createHouse(3, solvedRiddles[3])}
                        </div>
                        
                        <div class="grid grid-cols-2 gap-12 mb-16 max-w-md mx-auto">
                            ${createHouse(4, solvedRiddles[4])}
                            ${createHouse(5, solvedRiddles[5])}
                        </div>

                        <div class="text-center">
                            <button onclick="goToPlaza()" class="px-8 py-4 rounded-lg font-bold text-lg transition-all ${plazaButtonClass}">
                                ğŸ‘¥ åºƒå ´ã¸ ${allSolved ? 'ğŸ‰' : ''}
                            </button>
                        </div>

                        <div class="mt-8 text-center">
                            <p class="text-lg font-semibold">
                                è§£æ±ºæ¸ˆã¿: ${solvedCount} / ${villagers.length}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHouseScreen() {
            const villager = villagers.find(v => v.id === selectedHouse);
            const isSolved = solvedRiddles[villager.id];

            let content = '';
            if (!isSolved) {
                const feedbackHtml = showFeedback === 'correct' 
                    ? '<div class="mt-4 p-4 bg-green-100 border-2 border-green-500 rounded-lg text-center"><p class="text-xl font-bold text-green-700">ğŸ‰ æ­£è§£!</p></div>'
                    : showFeedback === 'wrong'
                    ? '<div class="mt-4 p-4 bg-red-100 border-2 border-red-500 rounded-lg text-center"><p class="text-xl font-bold text-red-700">âŒ é•ã„ã¾ã™...</p></div>'
                    : '';

                content = `
                    <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                        <p class="text-lg mb-2">ğŸ˜Ÿ <strong>æ‚©ã¿:</strong> ${villager.problem}</p>
                    </div>

                    <div class="mb-6 p-4 bg-purple-50 rounded-lg">
                        <p class="text-xl font-bold mb-3">ğŸ¤” ãªããªã:</p>
                        <p class="text-lg mb-4">${villager.riddle}</p>
                        <details class="text-sm text-gray-600">
                            <summary class="cursor-pointer hover:text-gray-800">ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</summary>
                            <p class="mt-2 pl-4">${villager.hint}</p>
                        </details>
                    </div>

                    <div class="mb-4">
                        <input type="text" id="answerInput" value="${userAnswer}" 
                            placeholder="ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            onkeypress="if(event.key==='Enter') submitAnswer()">
                    </div>

                    <button onclick="submitAnswer()" class="w-full px-6 py-3 bg-green-600 text-white rounded-lg font-bold text-lg hover:bg-green-700">
                        ç­”ãˆã‚‹
                    </button>

                    ${feedbackHtml}
                `;
            } else {
                content = `
                    <div class="text-center p-8 bg-green-50 rounded-lg">
                        <div class="text-6xl mb-4">â­</div>
                        <p class="text-2xl font-bold mb-4 text-green-700">è§£æ±ºæ¸ˆã¿!</p>
                        <p class="text-lg">${villager.celebration}</p>
                    </div>
                `;
            }

            return `
                <div class="min-h-screen bg-gradient-to-b from-amber-100 to-amber-200 p-8">
                    <button onclick="backToVillage()" class="mb-4 px-4 py-2 bg-amber-700 text-white rounded hover:bg-amber-800">
                        â† æ‘ã«æˆ»ã‚‹
                    </button>

                    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-xl p-8">
                        <h2 class="text-3xl font-bold mb-4 text-amber-900">${villager.name}</h2>
                        ${content}
                    </div>
                </div>
            `;
        }

        function renderPlazaScreen() {
            const allSolved = isAllSolved();
            
            let content = '';
            if (allSolved) {
                const villagersList = villagers.map(v => `
                    <div class="p-4 bg-yellow-50 rounded-lg">
                        <p class="font-bold">${v.name}</p>
                        <p class="text-sm text-gray-600">${v.celebration}</p>
                    </div>
                `).join('');

                content = `
                    <div class="bg-white rounded-lg shadow-xl p-12">
                        <h1 class="text-5xl font-bold mb-6 text-purple-900 animate-pulse">
                            ğŸ‰ æ‘ã®å®´ä¼š ğŸ‰
                        </h1>
                        <p class="text-2xl mb-8">ã¿ã‚“ãªã®æ‚©ã¿ã‚’è§£æ±ºã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†!</p>
                        
                        <div class="space-y-4 mb-8">
                            ${villagersList}
                        </div>

                        <div class="text-6xl mb-4">ğŸŠğŸˆğŸ†ğŸğŸ°</div>
                        <p class="text-xl font-bold text-purple-800">ãŠã‚ã§ã¨ã†!ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢!</p>
                        
                        <button onclick="resetGame()" class="mt-8 px-8 py-3 bg-purple-600 text-white rounded-lg font-bold hover:bg-purple-700">
                            æœ€åˆã‹ã‚‰éŠã¶
                        </button>
                    </div>
                `;
            } else {
                const remaining = villagers.length - Object.keys(solvedRiddles).length;
                content = `
                    <div class="bg-white rounded-lg shadow-xl p-12">
                        <h2 class="text-3xl font-bold mb-6 text-gray-700">åºƒå ´</h2>
                        <p class="text-xl mb-4">ã¾ã æº–å‚™ä¸­...</p>
                        <p class="text-lg text-gray-600">
                            å…¨ã¦ã®ä½æ°‘ã®æ‚©ã¿ã‚’è§£æ±ºã™ã‚‹ã¨ã€ã“ã“ã§å®´ä¼šãŒå§‹ã¾ã‚Šã¾ã™!
                        </p>
                        <p class="text-lg mt-4 font-semibold">
                            æ®‹ã‚Š ${remaining} äºº
                        </p>
                    </div>
                `;
            }

            return `
                <div class="min-h-screen bg-gradient-to-b from-purple-300 to-pink-200 p-8">
                    <button onclick="backToVillage()" class="mb-4 px-4 py-2 bg-purple-700 text-white rounded hover:bg-purple-800">
                        â† æ‘ã«æˆ»ã‚‹
                    </button>

                    <div class="max-w-3xl mx-auto text-center">
                        ${content}
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            if (currentScreen === 'village') {
                app.innerHTML = renderVillageScreen();
            } else if (currentScreen === 'house') {
                app.innerHTML = renderHouseScreen();
                if (!solvedRiddles[selectedHouse]) {
                    const input = document.getElementById('answerInput');
                    if (input) {
                        input.addEventListener('input', (e) => {
                            userAnswer = e.target.value;
                        });
                    }
                }
            } else if (currentScreen === 'plaza') {
                app.innerHTML = renderPlazaScreen();
            }
        }

        function openHouse(houseNumber) {
            selectedHouse = houseNumber;
            currentScreen = 'house';
            userAnswer = '';
            showFeedback = null;
            render();
        }

        function backToVillage() {
            currentScreen = 'village';
            userAnswer = '';
            showFeedback = null;
            render();
        }

        function goToPlaza() {
            currentScreen = 'plaza';
            render();
        }

        function submitAnswer() {
            const villager = villagers.find(v => v.id === selectedHouse);
            const input = document.getElementById('answerInput');
            if (input) {
                userAnswer = input.value;
            }
            
            const normalized = userAnswer.trim().toLowerCase().replace(/\s/g, '');
            const correctAnswer = villager.answer.toLowerCase().replace(/\s/g, '');
            
            if (normalized === correctAnswer) {
                solvedRiddles[villager.id] = true;
                showFeedback = 'correct';
                render();
                setTimeout(() => {
                    showFeedback = null;
                    userAnswer = '';
                    render();
                }, 2000);
            } else {
                showFeedback = 'wrong';
                render();
                setTimeout(() => {
                    showFeedback = null;
                    render();
                }, 1500);
            }
        }

        function resetGame() {
            solvedRiddles = {};
            currentScreen = 'village';
            userAnswer = '';
            showFeedback = null;
            render();
        }

        // åˆæœŸè¡¨ç¤º
        render();
    </script>
</body>
</html>